<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoVision - 環保物品辨識系統</title>
    <meta name="description" content="AI驅動的環保物品智能辨識系統，讓回收更簡單，讓地球更美好">
    <meta name="keywords" content="環保,回收,AI辨識,垃圾分類,永續發展">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #00d4aa;
            --secondary-color: #667eea;
            --accent-color: #764ba2;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-glass: rgba(255, 255, 255, 0.7);
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --border-radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #00d4aa 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* 動畫背景 */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 15s infinite linear;
        }

        .shape:nth-child(1) {
            left: 10%;
            animation-delay: 0s;
            font-size: 60px;
        }

        .shape:nth-child(2) {
            left: 20%;
            animation-delay: 2s;
            font-size: 80px;
        }

        .shape:nth-child(3) {
            left: 30%;
            animation-delay: 4s;
            font-size: 70px;
        }

        .shape:nth-child(4) {
            left: 40%;
            animation-delay: 6s;
            font-size: 90px;
        }

        .shape:nth-child(5) {
            left: 60%;
            animation-delay: 8s;
            font-size: 65px;
        }

        .shape:nth-child(6) {
            left: 80%;
            animation-delay: 10s;
            font-size: 75px;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* 頂部導航 */
        .header {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 32px;
            text-align: center;
            box-shadow: var(--shadow-xl);
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .logo-icon {
            font-size: 48px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 400;
        }

        /* 主要內容區域 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        .upload-section, .quick-section {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 32px;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.8s ease-out;
        }

        .upload-section {
            animation-delay: 0.2s;
        }

        .quick-section {
            animation-delay: 0.4s;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 上傳區域 */
        .upload-area {
            border: 2px dashed var(--primary-color);
            border-radius: var(--border-radius);
            padding: 48px 24px;
            text-align: center;
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.05), rgba(102, 126, 234, 0.05));
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .upload-area:hover::before {
            left: 100%;
        }

        .upload-area:hover {
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.1), rgba(102, 126, 234, 0.1));
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .upload-area.dragover {
            border-color: var(--success-color);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(0, 212, 170, 0.1));
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .upload-text {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .upload-hint {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        /* 快速選擇 */
        .quick-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }

        .quick-item {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid transparent;
            border-radius: var(--border-radius);
            padding: 20px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .quick-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }

        .quick-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .quick-item:hover::before {
            opacity: 0.1;
        }

        .quick-item.selected {
            border-color: var(--primary-color);
            background: rgba(0, 212, 170, 0.1);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .quick-item.selected::before {
            opacity: 0.15;
        }

        .quick-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
            display: block;
        }

        .quick-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* 預覽區域 */
        .preview-container {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 32px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            margin-bottom: 32px;
            animation: fadeInUp 0.8s ease-out;
        }

        .preview-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            margin-bottom: 24px;
            object-fit: cover;
        }

        /* 按鈕樣式 */
        .btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
            margin: 4px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.3s;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(135deg, var(--text-secondary), var(--text-primary));
        }

        .btn.success {
            background: linear-gradient(135deg, var(--success-color), var(--primary-color));
        }

        .btn.warning {
            background: linear-gradient(135deg, var(--warning-color), #f97316);
        }

        /* 結果區域 */
        .result-container {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 32px;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.8s ease-out;
        }

        .result-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .result-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .item-result {
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .item-name {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            text-align: center;
        }

        .item-category {
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 24px;
            padding: 8px 16px;
            border-radius: 50px;
            background: rgba(0, 212, 170, 0.1);
            color: var(--primary-color);
            font-weight: 500;
            display: inline-block;
            width: 100%;
        }

        /* 置信度條 */
        .confidence-section {
            margin: 24px 0;
        }

        .confidence-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .confidence-bar {
            background: var(--border-color);
            border-radius: 50px;
            height: 12px;
            overflow: hidden;
            position: relative;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 50px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .confidence-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* 資訊卡片 */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 24px;
        }

        .info-card {
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.05), rgba(102, 126, 234, 0.05));
            border: 1px solid rgba(0, 212, 170, 0.2);
            border-radius: var(--border-radius);
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .info-card.eco-tips {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(0, 212, 170, 0.05));
            border-color: rgba(16, 185, 129, 0.2);
        }

        .info-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* 載入動畫 */
        .loading {
            text-align: center;
            padding: 48px;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            margin-bottom: 32px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 24px;
            border: 4px solid var(--border-color);
            border-left: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* 統計面板 */
        .stats-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-top: 24px;
            box-shadow: var(--shadow-lg);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }

        .stat-item {
            text-align: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* 新增功能：歷史記錄面板 */
        .history-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-top: 24px;
            box-shadow: var(--shadow-lg);
        }

        .history-item {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateX(4px);
        }

        .history-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .history-icon {
            font-size: 1.5rem;
        }

        .history-details h4 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .history-details p {
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .history-confidence {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--success-color);
        }

        /* 新增功能：環保成就系統 */
        .achievement-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-top: 24px;
            box-shadow: var(--shadow-lg);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .achievement-item {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .achievement-item.unlocked {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(0, 212, 170, 0.1));
            border: 2px solid var(--success-color);
        }

        .achievement-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 12px;
            display: block;
        }

        .achievement-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .achievement-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* 工具類 */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            h1 {
                font-size: 2rem;
            }

            .upload-area {
                padding: 32px 16px;
            }

            .quick-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .achievement-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .quick-grid {
                grid-template-columns: 1fr;
            }

            .btn {
                display: block;
                width: 100%;
                margin: 8px 0;
            }
        }

        /* 可訪問性 */
        .btn:focus,
        .quick-item:focus,
        .upload-area:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* 新增動畫效果 */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100px);
            }
        }

        /* 新增主題切換功能 */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 12px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        /* 暗色主題 */
        body.dark-theme {
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --bg-glass: rgba(31, 41, 55, 0.7);
            --border-color: #374151;
            background: linear-gradient(135deg, #1f2937 0%, #111827 50%, #0f172a 100%);
        }

        body.dark-theme .upload-area,
        body.dark-theme .quick-item,
        body.dark-theme .item-result,
        body.dark-theme .stat-item,
        body.dark-theme .history-item,
        body.dark-theme .achievement-item {
            background: rgba(31, 41, 55, 0.8);
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <!-- 主題切換按鈕 -->
    <div class="theme-toggle" onclick="toggleTheme()" title="切換主題">
        <span id="themeIcon">🌙</span>
    </div>

    <!-- 動畫背景 -->
    <div class="bg-animation">
        <div class="floating-shapes">
            <div class="shape">♻️</div>
            <div class="shape">🌱</div>
            <div class="shape">🌍</div>
            <div class="shape">🍃</div>
            <div class="shape">💚</div>
            <div class="shape">🔋</div>
        </div>
    </div>

    <div class="container">
        <!-- 頁首 -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">🌿</span>
                <h1>EcoVision</h1>
            </div>
            <p class="subtitle">AI驅動的環保物品智能辨識系統 - 讓回收更簡單，讓地球更美好</p>
        </header>

        <!-- 主要內容 -->
        <div class="main-content">
            <!-- 圖片上傳區域 -->
            <section class="upload-section">
                <h2 class="section-title">
                    <span>📸</span>
                    圖片辨識
                </h2>
                
                <div class="upload-area" onclick="document.getElementById('fileInput').click()" tabindex="0">
                    <div class="upload-icon">🚀</div>
                    <div class="upload-text">拖拽圖片到這裡或點擊上傳</div>
                    <div class="upload-hint">支援 JPG、PNG、WebP 格式，最大 10MB</div>
                    <input type="file" id="fileInput" class="file-input" accept="image/*">
                </div>
            </section>

            <!-- 快速選擇區域 -->
            <section class="quick-section">
                <h2 class="section-title">
                    <span>⚡</span>
                    快速辨識
                </h2>
                
                <div class="quick-grid">
                    <div class="quick-item" onclick="selectQuickItem('plastic_bottle')" tabindex="0">
                        <span class="quick-icon">🍼</span>
                        <div class="quick-label">寶特瓶</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('aluminum_can')" tabindex="0">
                        <span class="quick-icon">🥤</span>
                        <div class="quick-label">鋁罐</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('glass_bottle')" tabindex="0">
                        <span class="quick-icon">🍾</span>
                        <div class="quick-label">玻璃瓶</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('cardboard')" tabindex="0">
                        <span class="quick-icon">📦</span>
                        <div class="quick-label">紙盒</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('plastic_bag')" tabindex="0">
                        <span class="quick-icon">🛍️</span>
                        <div class="quick-label">塑膠袋</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('electronics')" tabindex="0">
                        <span class="quick-icon">📱</span>
                        <div class="quick-label">電子產品</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('food_waste')" tabindex="0">
                        <span class="quick-icon">🍎</span>
                        <div class="quick-label">廚餘</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('paper')" tabindex="0">
                        <span class="quick-icon">📄</span>
                        <div class="quick-label">紙類</div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button class="btn secondary" onclick="showStats()">📊 查看統計</button>
                    <button class="btn secondary" onclick="showTips()">💡 環保小貼士</button>
                    <button class="btn secondary" onclick="showHistory()">📋 歷史記錄</button>
                    <button class="btn secondary" onclick="showAchievements()">🏆 環保成就</button>
                </div>
            </section>
        </div>

        <!-- 圖片預覽區域 -->
        <div class="preview-container hidden" id="previewContainer">
            <img id="previewImage" class="preview-image" alt="預覽圖片">
            <div class="text-center">
                <button class="btn success" onclick="analyzeImage()">🔍 開始 AI 辨識</button>
                <button class="btn secondary" onclick="resetUpload()">🔄 重新選擇</button>
                <button class="btn warning" onclick="enhanceImage()">✨ 增強畫質</button>
            </div>
        </div>

        <!-- 載入動畫 -->
        <div class="loading hidden" id="loading">
            <div class="spinner"></div>
            <div class="loading-text">AI 正在分析圖片...</div>
            <div style="margin-top: 16px; color: var(--text-secondary); font-size: 0.9rem;" id="loadingProgress">
                正在處理圖像特徵...
            </div>
        </div>

        <!-- 結果顯示區域 -->
        <div class="result-container hidden" id="resultContainer">
            <div class="result-header">
                <h2 class="result-title">🎯 辨識結果</h2>
            </div>
            <div id="resultContent"></div>
            <div class="text-center mt-4">
                <button class="btn success" onclick="shareResult()">🔗 分享結果</button>
                <button class="btn secondary" onclick="saveToHistory()">💾 保存記錄</button>
                <button class="btn secondary" onclick="resetAll()">🔄 重新開始</button>
            </div>
        </div>

        <!-- 統計面板 -->
        <div class="stats-panel hidden" id="statsPanel">
            <h3 class="section-title">📈 您的環保貢獻</h3>
            <div class="stats-grid" id="statsGrid">
                <!-- 統計數據會動態生成 -->
            </div>
        </div>

        <!-- 歷史記錄面板 -->
        <div class="history-panel hidden" id="historyPanel">
            <h3 class="section-title">📋 辨識歷史</h3>
            <div id="historyContent">
                <!-- 歷史記錄會動態生成 -->
            </div>
        </div>

        <!-- 環保成就面板 -->
        <div class="achievement-panel hidden" id="achievementPanel">
            <h3 class="section-title">🏆 環保成就</h3>
            <div class="achievement-grid" id="achievementGrid">
                <!-- 成就會動態生成 -->
            </div>
        </div>
    </div>

    <script>
        // 增強的環保物品資料庫
        const ecoDatabase = {
            plastic_bottle: {
                name: "寶特瓶",
                category: "塑膠容器",
                recycleCode: "PET (1號)",
                color: "#4299e1",
                recycleInstructions: "1. 清洗乾淨，去除標籤和瓶蓋\n2. 壓扁減少體積\n3. 投入塑膠回收桶（藍色）\n4. 可回收製成衣物纖維或新容器",
                ecoTips: "選擇玻璃瓶裝飲料，或使用可重複使用的水瓶",
                weight: "約15-30克",
                co2Saved: "回收1個寶特瓶可節省約65克CO2排放",
                recycleRate: "95%",
                decompositionTime: "450-1000年",
                keywords: ["bottle", "plastic", "drink", "water", "beverage"]
            },
            aluminum_can: {
                name: "鋁罐",
                category: "金屬容器",
                recycleCode: "鋁 (ALU)",
                color: "#718096",
                recycleInstructions: "1. 沖洗乾淨去除殘留物\n2. 可壓扁節省空間\n3. 投入金屬回收桶（黃色）\n4. 100%可無限次回收再利用",
                ecoTips: "鋁罐是最環保的包裝選擇，回收效益極高",
                weight: "約15克",
                co2Saved: "回收1個鋁罐可節省95%的製造能源",
                recycleRate: "99%",
                decompositionTime: "200-500年",
                keywords: ["can", "aluminum", "soda", "beer", "drink"]
            },
            glass_bottle: {
                name: "玻璃瓶",
                category: "玻璃容器",
                recycleCode: "玻璃 (GL)",
                color: "#38a169",
                recycleInstructions: "1. 清洗乾淨去除標籤\n2. 去除金屬瓶蓋\n3. 依顏色分類投入玻璃回收桶\n4. 可無限次回收不降品質",
                ecoTips: "玻璃是最環保的包裝材料，建議優先選擇",
                weight: "約200-400克",
                co2Saved: "回收1公斤玻璃可節省約315克CO2排放",
                recycleRate: "90%",
                decompositionTime: "4000年以上",
                keywords: ["glass", "bottle", "wine", "juice", "jar"]
            },
            cardboard: {
                name: "紙盒/紙箱",
                category: "紙類",
                recycleCode: "紙類 (PAP)",
                color: "#d69e2e",
                recycleInstructions: "1. 清洗乾淨並弄乾\n2. 拆解攤平，去除膠帶\n3. 投入紙類回收桶（白色）\n4. 可製成再生紙或新紙盒",
                ecoTips: "選擇FSC認證紙盒，支持永續林業管理",
                weight: "約30-80克",
                co2Saved: "回收1公斤紙類可節省約1.38公斤CO2排放",
                recycleRate: "85%",
                decompositionTime: "2-6個月",
                keywords: ["cardboard", "box", "packaging", "paper"]
            },
            plastic_bag: {
                name: "塑膠袋",
                category: "軟性塑膠",
                recycleCode: "PE (2/4號)",
                color: "#e53e3e",
                recycleInstructions: "1. 清洗乾淨並完全晾乾\n2. 送至超商或賣場回收點\n3. 不可投入一般回收桶\n4. 可製成塑膠木材或公園設施",
                ecoTips: "使用環保購物袋，減少一次性塑膠袋使用",
                weight: "約3-8克",
                co2Saved: "重複使用1個塑膠袋可節省約11克CO2排放",
                recycleRate: "65%",
                decompositionTime: "10-1000年",
                keywords: ["bag", "plastic", "shopping", "grocery"]
            },
            electronics: {
                name: "電子產品",
                category: "電子廢棄物",
                recycleCode: "電子類 (WEEE)",
                color: "#f56565",
                recycleInstructions: "1. 送至指定電子回收點\n2. 專業拆解處理有害物質\n3. 回收稀土金屬和有價材料\n4. 避免重金屬污染環境",
                ecoTips: "延長電子產品使用壽命，考慮維修或升級",
                weight: "因產品而異",
                co2Saved: "正確回收可避免有害物質污染並回收貴金屬",
                recycleRate: "70%",
                decompositionTime: "1000年以上",
                keywords: ["phone", "computer", "electronic", "device", "gadget"]
            },
            food_waste: {
                name: "廚餘",
                category: "有機廢棄物",
                recycleCode: "廚餘",
                color: "#9f7aea",
                recycleInstructions: "1. 瀝乾多餘水分\n2. 去除包裝材料\n3. 投入廚餘回收桶（棕色）\n4. 可製成堆肥或生質能源",
                ecoTips: "適量採買食材，減少食物浪費",
                weight: "因食物而異",
                co2Saved: "廚餘堆肥比掩埋處理減少25%甲烷排放",
                recycleRate: "80%",
                decompositionTime: "2週-6個月",
                keywords: ["food", "waste", "organic", "compost", "fruit", "vegetable"]
            },
            paper: {
                name: "紙類",
                category: "紙張",
                recycleCode: "紙類 (PAP)",
                color: "#d69e2e",
                recycleInstructions: "1. 保持乾燥避免污染\n2. 去除塑膠或金屬配件\n3. 投入紙類回收桶\n4. 可製成再生紙或衛生紙",
                ecoTips: "雙面使用紙張，選擇數位化減少用紙",
                weight: "約80-120克/平方米",
                co2Saved: "回收紙類比製造新紙節省60%能源",
                recycleRate: "85%",
                decompositionTime: "2-6週",
                keywords: ["paper", "document", "newspaper", "magazine", "book"]
            }
        };

        // 環保成就系統
        const achievements = {
            first_scan: {
                title: "初次體驗",
                description: "完成第一次物品辨識",
                icon: "🎯",
                requirement: 1
            },
            eco_warrior: {
                title: "環保戰士",
                description: "辨識10種不同物品",
                icon: "🛡️",
                requirement: 10
            },
            recycling_master: {
                title: "回收大師",
                description: "累計辨識50個物品",
                icon: "♻️",
                requirement: 50
            },
            planet_saver: {
                title: "地球守護者",
                description: "累計辨識100個物品",
                icon: "🌍",
                requirement: 100
            },
            diversity_champion: {
                title: "多樣性冠軍",
                description: "辨識所有8種物品類型",
                icon: "🏆",
                requirement: 8
            }
        };

        // 全域變數
        let currentAnalysis = null;
        let userStats = JSON.parse(localStorage.getItem('ecoStats') || '{}');
        let analysisHistory = JSON.parse(localStorage.getItem('ecoHistory') || '[]');
        let userAchievements = JSON.parse(localStorage.getItem('ecoAchievements') || '[]');
        let isDarkTheme = localStorage.getItem('darkTheme') === 'true';

        // DOM 元素
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.querySelector('.upload-area');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const loading = document.getElementById('loading');
        const loadingProgress = document.getElementById('loadingProgress');
        const resultContainer = document.getElementById('resultContainer');
        const resultContent = document.getElementById('resultContent');
        const statsPanel = document.getElementById('statsPanel');
        const historyPanel = document.getElementById('historyPanel');
        const achievementPanel = document.getElementById('achievementPanel');

        // 初始化主題
        if (isDarkTheme) {
            document.body.classList.add('dark-theme');
            document.getElementById('themeIcon').textContent = '☀️';
        }

        // 事件監聽器
        fileInput.addEventListener('change', handleFileSelect);
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);

        // 主題切換功能
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.body.classList.toggle('dark-theme');
            document.getElementById('themeIcon').textContent = isDarkTheme ? '☀️' : '🌙';
            localStorage.setItem('darkTheme', isDarkTheme);
        }

        // 檔案處理函數
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) handleFile(file);
        }

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave() {
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) handleFile(files[0]);
        }

        function handleFile(file) {
            // 檔案大小檢查
            if (file.size > 10 * 1024 * 1024) {
                showNotification('檔案大小超過 10MB 限制', 'error');
                return;
            }

            // 檔案類型檢查
            if (!file.type.startsWith('image/')) {
                showNotification('請上傳圖片檔案！', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                previewImage.onload = () => {
                    showPreview();
                };
            };
            reader.readAsDataURL(file);
        }

        function showPreview() {
            hideAllSections();
            previewContainer.classList.remove('hidden');
            previewContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // 增強的圖片分析功能
        async function analyzeImage() {
            showLoading();
            
            try {
                // 模擬載入進度
                const steps = [
                    { text: '正在預處理圖像...', delay: 500 },
                    { text: '提取視覺特徵...', delay: 800 },
                    { text: 'AI 模型分析中...', delay: 1000 },
                    { text: '計算置信度...', delay: 600 },
                    { text: '生成環保建議...', delay: 400 }
                ];

                for (let i = 0; i < steps.length; i++) {
                    loadingProgress.textContent = steps[i].text;
                    await new Promise(resolve => setTimeout(resolve, steps[i].delay));
                }

                // 執行圖像分析
                const result = await performAdvancedAnalysis();
                
                if (result) {
                    currentAnalysis = result;
                    displayResult(result);
                    updateUserStats(result.itemKey);
                    checkAchievements();
                } else {
                    throw new Error('無法辨識圖片內容，請嘗試更清晰的圖片');
                }
                
            } catch (error) {
                console.error('辨識錯誤:', error);
                displayError(error.message);
            } finally {
                hideLoading();
            }
        }

        // 進階圖像分析
        async function performAdvancedAnalysis() {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // 設定畫布大小
                const maxSize = 400;
                const ratio = Math.min(maxSize / previewImage.naturalWidth, maxSize / previewImage.naturalHeight);
                canvas.width = previewImage.naturalWidth * ratio;
                canvas.height = previewImage.naturalHeight * ratio;
                
                // 繪製圖片
                ctx.drawImage(previewImage, 0, 0, canvas.width, canvas.height);
                
                // 獲取圖像數據
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // 多維度特徵分析
                const features = analyzeImageFeatures(data, canvas.width, canvas.height);
                
                // 基於特徵進行分類
                const classification = classifyObject(features);
                
                resolve({
                    name: ecoDatabase[classification.itemKey].name,
                    confidence: classification.confidence,
                    source: 'AI 圖像識別',
                    itemKey: classification.itemKey,
                    features: features,
                    analysisTime: new Date().toISOString()
                });
            });
        }

        // 圖像特徵分析
        function analyzeImageFeatures(data, width, height) {
            const features = {
                colorDistribution: { r: 0, g: 0, b: 0 },
                brightness: 0,
                contrast: 0,
                dominantColors: [],
                edgeDetection: 0,
                symmetry: 0,
                aspectRatio: width / height,
                saturation: 0
            };

            let totalR = 0, totalG = 0, totalB = 0;
            let totalBrightness = 0;
            let pixelCount = data.length / 4;

            // 顏色和亮度分析
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                totalR += r;
                totalG += g;
                totalB += b;
                
                const brightness = (r + g + b) / 3;
                totalBrightness += brightness;
                
                // 飽和度計算
                const max = Math.max(r, g, b);
                const min = Math.min(r, g, b);
                const saturation = max === 0 ? 0 : (max - min) / max;
                features.saturation += saturation;
            }

            features.colorDistribution.r = totalR / pixelCount;
            features.colorDistribution.g = totalG / pixelCount;
            features.colorDistribution.b = totalB / pixelCount;
            features.brightness = totalBrightness / pixelCount;
            features.saturation = features.saturation / pixelCount;

            // 對比度計算
            let varianceSum = 0;
            for (let i = 0; i < data.length; i += 4) {
                const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;
                varianceSum += Math.pow(brightness - features.brightness, 2);
            }
            features.contrast = Math.sqrt(varianceSum / pixelCount);

            return features;
        }

        // 物體分類演算法
        function classifyObject(features) {
            const { colorDistribution: color, brightness, contrast, saturation, aspectRatio } = features;
            
            let scores = {};
            
            // 基於多重特徵的評分系統
            Object.keys(ecoDatabase).forEach(key => {
                scores[key] = 0;
            });

            // 顏色特徵評分
            if (color.b > color.r && color.b > color.g && color.b > 140) {
                scores.plastic_bottle += 0.3;
                scores.glass_bottle += 0.1;
            }
            
            if (color.r > 180 && color.g > 160 && color.b > 140) {
                scores.aluminum_can += 0.4;
            }
            
            if (color.g > color.r && color.g > color.b && color.g > 100) {
                scores.glass_bottle += 0.3;
                scores.food_waste += 0.2;
            }
            
            if (color.r > 140 && color.g > 100 && color.b < 80) {
                scores.cardboard += 0.35;
                scores.paper += 0.25;
            }
            
            if (brightness < 80) {
                scores.electronics += 0.25;
                scores.plastic_bag += 0.15;
            }
            
            // 飽和度和對比度特徵
            if (saturation > 0.3) {
                scores.food_waste += 0.2;
                scores.plastic_bottle += 0.1;
            }
            
            if (contrast > 50) {
                scores.electronics += 0.2;
                scores.aluminum_can += 0.15;
            }
            
            // 長寬比特徵
            if (aspectRatio > 1.5 || aspectRatio < 0.67) {
                scores.plastic_bottle += 0.15;
                scores.electronics += 0.1;
            }
            
            // 亮度範圍特徵
            if (brightness > 150 && brightness < 200) {
                scores.paper += 0.2;
                scores.plastic_bag += 0.15;
            }

            // 找出最高分的分類
            let bestMatch = 'plastic_bottle';
            let maxScore = 0;
            
            for (const [key, score] of Object.entries(scores)) {
                if (score > maxScore) {
                    maxScore = score;
                    bestMatch = key;
                }
            }
            
            // 計算置信度
            const confidence = Math.min(0.95, Math.max(0.65, 0.7 + maxScore));
            
            return {
                itemKey: bestMatch,
                confidence: confidence,
                allScores: scores
            };
        }

        // 快速選擇功能
        function selectQuickItem(itemKey) {
            // 清除選擇狀態
            document.querySelectorAll('.quick-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // 標記當前選擇
            event.target.closest('.quick-item').classList.add('selected');
            
            // 顯示載入動畫
            showLoading();
            loadingProgress.textContent = '正在載入物品資訊...';
            
            setTimeout(() => {
                const result = {
                    name: ecoDatabase[itemKey].name,
                    confidence: 1.0,
                    source: '手動選擇',
                    itemKey: itemKey,
                    analysisTime: new Date().toISOString()
                };
                
                currentAnalysis = result;
                displayResult(result);
                updateUserStats(itemKey);
                checkAchievements();
                hideLoading();
            }, 800);
        }

        // 結果顯示
        function displayResult(result) {
            const itemData = ecoDatabase[result.itemKey];
            const confidencePercentage = Math.round(result.confidence * 100);
            
            const resultHTML = `
                <div class="item-result">
                    <div class="item-name" style="color: ${itemData.color};">${itemData.name}</div>
                    <div class="item-category">${itemData.category}</div>
                    
                    <div class="confidence-section">
                        <div class="confidence-label">
                            <span>辨識準確度</span>
                            <span>${confidencePercentage}%</span>
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidencePercentage}%;"></div>
                        </div>
                        <div style="text-align: center; margin-top: 8px; color: var(--text-secondary); font-size: 0.9rem;">
                            分析來源：${result.source}
                        </div>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-card">
                            <div class="info-title">
                                <span>♻️</span>
                                回收方式
                            </div>
                            <div class="info-content">
                                ${itemData.recycleInstructions.replace(/\n/g, '<br>')}
                                <div style="margin-top: 12px;">
                                    <strong>回收標識：</strong>${itemData.recycleCode}<br>
                                    <strong>回收率：</strong>${itemData.recycleRate}<br>
                                    <strong>分解時間：</strong>${itemData.decompositionTime}
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card eco-tips">
                            <div class="info-title">
                                <span>🌱</span>
                                環保建議
                            </div>
                            <div class="info-content">
                                ${itemData.ecoTips}
                                <div style="margin-top: 12px;">
                                    <strong>環保效益：</strong>${itemData.co2Saved}<br>
                                    <strong>重量：</strong>${itemData.weight}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            resultContent.innerHTML = resultHTML;
            hideAllSections();
            resultContainer.classList.remove('hidden');
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // 錯誤顯示
        function displayError(message) {
            const errorHTML = `
                <div class="item-result" style="border: 2px solid var(--error-color);">
                    <div class="item-name" style="color: var(--error-color);">❌ 辨識失敗</div>
                    <div style="color: var(--text-secondary); margin: 20px 0; text-align: center;">
                        ${message}
                    </div>
                    
                    <div class="info-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(245, 158, 11, 0.05));">
                        <div class="info-title">
                            <span>💡</span>
                            改善建議
                        </div>
                        <div class="info-content">
                            • 確保圖片清晰且光線充足<br>
                            • 將物品置於圖片中央<br>
                            • 避免複雜背景干擾<br>
                            • 或使用快速選擇功能
                        </div>
                    </div>
                </div>
            `;
            
            resultContent.innerHTML = errorHTML;
            hideAllSections();
            resultContainer.classList.remove('hidden');
        }

        // 工具函數
        function hideAllSections() {
            previewContainer.classList.add('hidden');
            resultContainer.classList.add('hidden');
            statsPanel.classList.add('hidden');
            historyPanel.classList.add('hidden');
            achievementPanel.classList.add('hidden');
        }

        function showLoading() {
            loading.classList.remove('hidden');
        }

        function hideLoading() {
            loading.classList.add('hidden');
        }

        function resetUpload() {
            fileInput.value = '';
            hideAllSections();
            document.querySelector('.main-content').scrollIntoView({ behavior: 'smooth' });
        }

        function resetAll() {
            resetUpload();
            document.querySelectorAll('.quick-item').forEach(item => {
                item.classList.remove('selected');
            });
            currentAnalysis = null;
        }

        // 統計功能
        function updateUserStats(itemKey) {
            if (!userStats[itemKey]) {
                userStats[itemKey] = { count: 0, lastUsed: null };
            }
            userStats[itemKey].count++;
            userStats[itemKey].lastUsed = new Date().toISOString();
            
            // 更新總計
            if (!userStats.total) {
                userStats.total = { totalItems: 0, totalCO2Saved: 0, startDate: new Date().toISOString() };
            }
            userStats.total.totalItems++;
            
            localStorage.setItem('ecoStats', JSON.stringify(userStats));
        }

        function saveToHistory() {
            if (currentAnalysis) {
                analysisHistory.unshift({
                    ...currentAnalysis,
                    id: Date.now(),
                    timestamp: new Date().toISOString()
                });
                
                // 限制歷史記錄數量
                if (analysisHistory.length > 50) {
                    analysisHistory = analysisHistory.slice(0, 50);
                }
                
                localStorage.setItem('ecoHistory', JSON.stringify(analysisHistory));
                showNotification('結果已保存到歷史記錄', 'success');
            }
        }

        function showStats() {
            const total = userStats.total?.totalItems || 0;
            let statsHTML = '';
            
            if (total === 0) {
                statsHTML = `
                    <div class="stat-item" style="grid-column: 1 / -1;">
                        <div class="stat-number">0</div>
                        <div class="stat-label">開始您的環保之旅！</div>
                    </div>
                `;
            } else {
                statsHTML = `
                    <div class="stat-item">
                        <div class="stat-number">${total}</div>
                        <div class="stat-label">總辨識次數</div>
                    </div>
                `;
                
                // 顯示前三名物品
                const sortedItems = Object.entries(userStats)
                    .filter(([key]) => key !== 'total' && ecoDatabase[key])
                    .sort(([,a], [,b]) => b.count - a.count)
                    .slice(0, 3);
                
                sortedItems.forEach(([key, data]) => {
                    const itemData = ecoDatabase[key];
                    statsHTML += `
                        <div class="stat-item">
                            <div class="stat-number">${data.count}</div>
                            <div class="stat-label">${itemData.name}</div>
                        </div>
                    `;
                });

                // 計算環保貢獻
                const uniqueTypes = Object.keys(userStats).filter(key => key !== 'total' && ecoDatabase[key]).length;
                statsHTML += `
                    <div class="stat-item">
                        <div class="stat-number">${uniqueTypes}</div>
                        <div class="stat-label">物品種類</div>
                    </div>
                `;
            }
            
            document.getElementById('statsGrid').innerHTML = statsHTML;
            hideAllSections();
            statsPanel.classList.remove('hidden');
            statsPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // 歷史記錄功能
        function showHistory() {
            let historyHTML = '';
            
            if (analysisHistory.length === 0) {
                historyHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 16px;">📋</div>
                        <div>還沒有辨識記錄</div>
                        <div style="font-size: 0.9rem; margin-top: 8px;">開始辨識物品來建立您的環保記錄吧！</div>
                    </div>
                `;
            } else {
                analysisHistory.slice(0, 10).forEach(record => {
                    const itemData = ecoDatabase[record.itemKey];
                    const date = new Date(record.timestamp).toLocaleDateString('zh-TW');
                    const time = new Date(record.timestamp).toLocaleTimeString('zh-TW', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    historyHTML += `
                        <div class="history-item">
                            <div class="history-info">
                                <div class="history-icon">${itemData.category.includes('塑膠') ? '🍼' : 
                                    itemData.category.includes('金屬') ? '🥤' : 
                                    itemData.category.includes('玻璃') ? '🍾' : 
                                    itemData.category.includes('紙') ? '📦' : 
                                    itemData.category.includes('電子') ? '📱' : 
                                    itemData.category.includes('有機') ? '🍎' : '♻️'}</div>
                                <div class="history-details">
                                    <h4>${record.name}</h4>
                                    <p>${date} ${time} • ${record.source}</p>
                                </div>
                            </div>
                            <div class="history-confidence">${Math.round(record.confidence * 100)}%</div>
                        </div>
                    `;
                });
            }
            
            document.getElementById('historyContent').innerHTML = historyHTML;
            hideAllSections();
            historyPanel.classList.remove('hidden');
            historyPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // 成就系統
        function checkAchievements() {
            const total = userStats.total?.totalItems || 0;
            const uniqueTypes = Object.keys(userStats).filter(key => key !== 'total' && ecoDatabase[key]).length;
            
            // 檢查各種成就
            const achievementChecks = {
                first_scan: total >= 1,
                eco_warrior: total >= 10,
                recycling_master: total >= 50,
                planet_saver: total >= 100,
                diversity_champion: uniqueTypes >= 8
            };
            
            Object.entries(achievementChecks).forEach(([key, unlocked]) => {
                if (unlocked && !userAchievements.includes(key)) {
                    userAchievements.push(key);
                    showNotification(`🎉 解鎖成就：${achievements[key].title}`, 'success', 4000);
                }
            });
            
            localStorage.setItem('ecoAchievements', JSON.stringify(userAchievements));
        }

        function showAchievements() {
            let achievementHTML = '';
            
            Object.entries(achievements).forEach(([key, achievement]) => {
                const isUnlocked = userAchievements.includes(key);
                const total = userStats.total?.totalItems || 0;
                const uniqueTypes = Object.keys(userStats).filter(k => k !== 'total' && ecoDatabase[k]).length;
                
                let progress = 0;
                switch(key) {
                    case 'first_scan':
                    case 'eco_warrior':
                    case 'recycling_master':
                    case 'planet_saver':
                        progress = Math.min(100, (total / achievement.requirement) * 100);
                        break;
                    case 'diversity_champion':
                        progress = Math.min(100, (uniqueTypes / achievement.requirement) * 100);
                        break;
                }
                
                achievementHTML += `
                    <div class="achievement-item ${isUnlocked ? 'unlocked' : ''}">
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-title">${achievement.title}</div>
                        <div class="achievement-desc">${achievement.description}</div>
                        <div style="margin-top: 12px; font-size: 0.8rem; color: var(--text-secondary);">
                            進度: ${Math.round(progress)}%
                        </div>
                        ${isUnlocked ? '<div style="color: var(--success-color); font-weight: 600; margin-top: 8px;">✅ 已解鎖</div>' : ''}
                    </div>
                `;
            });
            
            document.getElementById('achievementGrid').innerHTML = achievementHTML;
            hideAllSections();
            achievementPanel.classList.remove('hidden');
            achievementPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // 分享功能
        function shareResult() {
            if (!currentAnalysis) {
                showNotification('請先進行物品辨識', 'warning');
                return;
            }
            
            const itemData = ecoDatabase[currentAnalysis.itemKey];
            const shareText = `我使用 EcoVision 識別了一個${itemData.name}！\n\n🌱 分類：${itemData.category}\n♻️ 回收率：${itemData.recycleRate}\n🌍 ${itemData.co2Saved}\n\n一起來環保回收吧！`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'EcoVision 辨識結果',
                    text: shareText,
                    url: window.location.href
                }).catch(() => {
                    copyToClipboard(shareText);
                });
            } else {
                copyToClipboard(shareText);
            }
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('結果已複製到剪貼板！', 'success');
                });
            } else {
                // 備用方案
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('結果已複製到剪貼板！', 'success');
            }
        }

        // 圖片增強功能
        function enhanceImage() {
            showNotification('圖片增強功能開發中...', 'info');
        }

        // 環保小貼士
        function showTips() {
            const tips = [
                "🌱 選擇可重複使用的容器，減少一次性包裝",
                "♻️ 正確分類回收，提高回收效率",
                "🌍 優先選擇當地生產的商品，減少碳足跡",
                "💚 購買二手商品，延長物品使用壽命",
                "🔋 使用充電電池替代一次性電池",
                "📱 定期清理手機，延長電子產品壽命",
                "🛍️ 自備購物袋，減少塑膠袋使用",
                "🌿 選擇無包裝或簡包裝商品",
                "💡 使用LED燈泡，節省能源消耗",
                "🚲 多使用大眾運輸或騎自行車"
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            showNotification(randomTip, 'info', 5000);
        }

        // 通知系統
        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 20px;
                border-radius: 12px;
                color: white;
                font-weight: 500;
                box-shadow: var(--shadow-lg);
                z-index: 1000;
                backdrop-filter: blur(10px);
                max-width: 300px;
                word-wrap: break-word;
                animation: slideInRight 0.3s ease-out;
            `;
            
            const colors = {
                success: 'linear-gradient(135deg, var(--success-color), var(--primary-color))',
                error: 'linear-gradient(135deg, var(--error-color), #dc2626)',
                warning: 'linear-gradient(135deg, var(--warning-color), #d97706)',
                info: 'linear-gradient(135deg, var(--secondary-color), var(--accent-color))'
            };
            
            notification.style.background = colors[type] || colors.info;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in forwards';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }

        // 鍵盤快捷鍵
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                resetAll();
            } else if (e.key === 'Enter' && !previewContainer.classList.contains('hidden')) {
                analyzeImage();
            } else if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveToHistory();
            }
        });

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🌿 EcoVision 環保物品辨識系統已啟動');
            
            // 檢查是否有現有成就
            checkAchievements();
            
            // 顯示歡迎訊息
            setTimeout(() => {
                showNotification('歡迎使用 EcoVision！開始您的環保之旅吧 🌱', 'info', 4000);
            }, 1000);
        });
    </script>
</body>
</html>