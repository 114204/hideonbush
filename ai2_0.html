<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoVision - ç’°ä¿ç‰©å“è¾¨è­˜ç³»çµ±</title>
    <meta name="description" content="AIé©…å‹•çš„ç’°ä¿ç‰©å“æ™ºèƒ½è¾¨è­˜ç³»çµ±ï¼Œè®“å›æ”¶æ›´ç°¡å–®ï¼Œè®“åœ°çƒæ›´ç¾å¥½">
    <meta name="keywords" content="ç’°ä¿,å›æ”¶,AIè¾¨è­˜,åƒåœ¾åˆ†é¡,æ°¸çºŒç™¼å±•">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #00d4aa;
            --secondary-color: #667eea;
            --accent-color: #764ba2;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-glass: rgba(255, 255, 255, 0.7);
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --border-radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #00d4aa 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* å‹•ç•«èƒŒæ™¯ */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 15s infinite linear;
        }

        .shape:nth-child(1) {
            left: 10%;
            animation-delay: 0s;
            font-size: 60px;
        }

        .shape:nth-child(2) {
            left: 20%;
            animation-delay: 2s;
            font-size: 80px;
        }

        .shape:nth-child(3) {
            left: 30%;
            animation-delay: 4s;
            font-size: 70px;
        }

        .shape:nth-child(4) {
            left: 40%;
            animation-delay: 6s;
            font-size: 90px;
        }

        .shape:nth-child(5) {
            left: 60%;
            animation-delay: 8s;
            font-size: 65px;
        }

        .shape:nth-child(6) {
            left: 80%;
            animation-delay: 10s;
            font-size: 75px;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* é ‚éƒ¨å°èˆª */
        .header {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 32px;
            text-align: center;
            box-shadow: var(--shadow-xl);
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .logo-icon {
            font-size: 48px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 400;
        }

        /* ä¸»è¦å…§å®¹å€åŸŸ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        .upload-section, .quick-section {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 32px;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.8s ease-out;
        }

        .upload-section {
            animation-delay: 0.2s;
        }

        .quick-section {
            animation-delay: 0.4s;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ä¸Šå‚³å€åŸŸ */
        .upload-area {
            border: 2px dashed var(--primary-color);
            border-radius: var(--border-radius);
            padding: 48px 24px;
            text-align: center;
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.05), rgba(102, 126, 234, 0.05));
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .upload-area:hover::before {
            left: 100%;
        }

        .upload-area:hover {
            border-color: var(--secondary-color);
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.1), rgba(102, 126, 234, 0.1));
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .upload-area.dragover {
            border-color: var(--success-color);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(0, 212, 170, 0.1));
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .upload-text {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .upload-hint {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        /* å¿«é€Ÿé¸æ“‡ */
        .quick-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }

        .quick-item {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid transparent;
            border-radius: var(--border-radius);
            padding: 20px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .quick-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }

        .quick-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .quick-item:hover::before {
            opacity: 0.1;
        }

        .quick-item.selected {
            border-color: var(--primary-color);
            background: rgba(0, 212, 170, 0.1);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .quick-item.selected::before {
            opacity: 0.15;
        }

        .quick-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
            display: block;
        }

        .quick-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* é è¦½å€åŸŸ */
        .preview-container {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 32px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            margin-bottom: 32px;
            animation: fadeInUp 0.8s ease-out;
        }

        .preview-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            margin-bottom: 24px;
            object-fit: cover;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
            margin: 4px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.3s;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(135deg, var(--text-secondary), var(--text-primary));
        }

        .btn.success {
            background: linear-gradient(135deg, var(--success-color), var(--primary-color));
        }

        .btn.warning {
            background: linear-gradient(135deg, var(--warning-color), #f97316);
        }

        /* çµæœå€åŸŸ */
        .result-container {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 32px;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.8s ease-out;
        }

        .result-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .result-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .item-result {
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .item-name {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            text-align: center;
        }

        .item-category {
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 24px;
            padding: 8px 16px;
            border-radius: 50px;
            background: rgba(0, 212, 170, 0.1);
            color: var(--primary-color);
            font-weight: 500;
            display: inline-block;
            width: 100%;
        }

        /* ç½®ä¿¡åº¦æ¢ */
        .confidence-section {
            margin: 24px 0;
        }

        .confidence-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .confidence-bar {
            background: var(--border-color);
            border-radius: 50px;
            height: 12px;
            overflow: hidden;
            position: relative;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 50px;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .confidence-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* è³‡è¨Šå¡ç‰‡ */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 24px;
        }

        .info-card {
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.05), rgba(102, 126, 234, 0.05));
            border: 1px solid rgba(0, 212, 170, 0.2);
            border-radius: var(--border-radius);
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .info-card.eco-tips {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(0, 212, 170, 0.05));
            border-color: rgba(16, 185, 129, 0.2);
        }

        .info-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* è¼‰å…¥å‹•ç•« */
        .loading {
            text-align: center;
            padding: 48px;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            margin-bottom: 32px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 24px;
            border: 4px solid var(--border-color);
            border-left: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* çµ±è¨ˆé¢æ¿ */
        .stats-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-top: 24px;
            box-shadow: var(--shadow-lg);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }

        .stat-item {
            text-align: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* æ–°å¢åŠŸèƒ½ï¼šæ­·å²è¨˜éŒ„é¢æ¿ */
        .history-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-top: 24px;
            box-shadow: var(--shadow-lg);
        }

        .history-item {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateX(4px);
        }

        .history-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .history-icon {
            font-size: 1.5rem;
        }

        .history-details h4 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .history-details p {
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .history-confidence {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--success-color);
        }

        /* æ–°å¢åŠŸèƒ½ï¼šç’°ä¿æˆå°±ç³»çµ± */
        .achievement-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-top: 24px;
            box-shadow: var(--shadow-lg);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .achievement-item {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .achievement-item.unlocked {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(0, 212, 170, 0.1));
            border: 2px solid var(--success-color);
        }

        .achievement-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 12px;
            display: block;
        }

        .achievement-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .achievement-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* å·¥å…·é¡ */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            h1 {
                font-size: 2rem;
            }

            .upload-area {
                padding: 32px 16px;
            }

            .quick-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .achievement-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .quick-grid {
                grid-template-columns: 1fr;
            }

            .btn {
                display: block;
                width: 100%;
                margin: 8px 0;
            }
        }

        /* å¯è¨ªå•æ€§ */
        .btn:focus,
        .quick-item:focus,
        .upload-area:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* æ–°å¢å‹•ç•«æ•ˆæœ */
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100px);
            }
        }

        /* æ–°å¢ä¸»é¡Œåˆ‡æ›åŠŸèƒ½ */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 12px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        /* æš—è‰²ä¸»é¡Œ */
        body.dark-theme {
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --bg-glass: rgba(31, 41, 55, 0.7);
            --border-color: #374151;
            background: linear-gradient(135deg, #1f2937 0%, #111827 50%, #0f172a 100%);
        }

        body.dark-theme .upload-area,
        body.dark-theme .quick-item,
        body.dark-theme .item-result,
        body.dark-theme .stat-item,
        body.dark-theme .history-item,
        body.dark-theme .achievement-item {
            background: rgba(31, 41, 55, 0.8);
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <!-- ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• -->
    <div class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">
        <span id="themeIcon">ğŸŒ™</span>
    </div>

    <!-- å‹•ç•«èƒŒæ™¯ -->
    <div class="bg-animation">
        <div class="floating-shapes">
            <div class="shape">â™»ï¸</div>
            <div class="shape">ğŸŒ±</div>
            <div class="shape">ğŸŒ</div>
            <div class="shape">ğŸƒ</div>
            <div class="shape">ğŸ’š</div>
            <div class="shape">ğŸ”‹</div>
        </div>
    </div>

    <div class="container">
        <!-- é é¦– -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">ğŸŒ¿</span>
                <h1>EcoVision</h1>
            </div>
            <p class="subtitle">AIé©…å‹•çš„ç’°ä¿ç‰©å“æ™ºèƒ½è¾¨è­˜ç³»çµ± - è®“å›æ”¶æ›´ç°¡å–®ï¼Œè®“åœ°çƒæ›´ç¾å¥½</p>
        </header>

        <!-- ä¸»è¦å…§å®¹ -->
        <div class="main-content">
            <!-- åœ–ç‰‡ä¸Šå‚³å€åŸŸ -->
            <section class="upload-section">
                <h2 class="section-title">
                    <span>ğŸ“¸</span>
                    åœ–ç‰‡è¾¨è­˜
                </h2>
                
                <div class="upload-area" onclick="document.getElementById('fileInput').click()" tabindex="0">
                    <div class="upload-icon">ğŸš€</div>
                    <div class="upload-text">æ‹–æ‹½åœ–ç‰‡åˆ°é€™è£¡æˆ–é»æ“Šä¸Šå‚³</div>
                    <div class="upload-hint">æ”¯æ´ JPGã€PNGã€WebP æ ¼å¼ï¼Œæœ€å¤§ 10MB</div>
                    <input type="file" id="fileInput" class="file-input" accept="image/*">
                </div>
            </section>

            <!-- å¿«é€Ÿé¸æ“‡å€åŸŸ -->
            <section class="quick-section">
                <h2 class="section-title">
                    <span>âš¡</span>
                    å¿«é€Ÿè¾¨è­˜
                </h2>
                
                <div class="quick-grid">
                    <div class="quick-item" onclick="selectQuickItem('plastic_bottle')" tabindex="0">
                        <span class="quick-icon">ğŸ¼</span>
                        <div class="quick-label">å¯¶ç‰¹ç“¶</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('aluminum_can')" tabindex="0">
                        <span class="quick-icon">ğŸ¥¤</span>
                        <div class="quick-label">é‹ç½</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('glass_bottle')" tabindex="0">
                        <span class="quick-icon">ğŸ¾</span>
                        <div class="quick-label">ç»ç’ƒç“¶</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('cardboard')" tabindex="0">
                        <span class="quick-icon">ğŸ“¦</span>
                        <div class="quick-label">ç´™ç›’</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('plastic_bag')" tabindex="0">
                        <span class="quick-icon">ğŸ›ï¸</span>
                        <div class="quick-label">å¡‘è† è¢‹</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('electronics')" tabindex="0">
                        <span class="quick-icon">ğŸ“±</span>
                        <div class="quick-label">é›»å­ç”¢å“</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('food_waste')" tabindex="0">
                        <span class="quick-icon">ğŸ</span>
                        <div class="quick-label">å»šé¤˜</div>
                    </div>
                    <div class="quick-item" onclick="selectQuickItem('paper')" tabindex="0">
                        <span class="quick-icon">ğŸ“„</span>
                        <div class="quick-label">ç´™é¡</div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button class="btn secondary" onclick="showStats()">ğŸ“Š æŸ¥çœ‹çµ±è¨ˆ</button>
                    <button class="btn secondary" onclick="showTips()">ğŸ’¡ ç’°ä¿å°è²¼å£«</button>
                    <button class="btn secondary" onclick="showHistory()">ğŸ“‹ æ­·å²è¨˜éŒ„</button>
                    <button class="btn secondary" onclick="showAchievements()">ğŸ† ç’°ä¿æˆå°±</button>
                </div>
            </section>
        </div>

        <!-- åœ–ç‰‡é è¦½å€åŸŸ -->
        <div class="preview-container hidden" id="previewContainer">
            <img id="previewImage" class="preview-image" alt="é è¦½åœ–ç‰‡">
            <div class="text-center">
                <button class="btn success" onclick="analyzeImage()">ğŸ” é–‹å§‹ AI è¾¨è­˜</button>
                <button class="btn secondary" onclick="resetUpload()">ğŸ”„ é‡æ–°é¸æ“‡</button>
                <button class="btn warning" onclick="enhanceImage()">âœ¨ å¢å¼·ç•«è³ª</button>
            </div>
        </div>

        <!-- è¼‰å…¥å‹•ç•« -->
        <div class="loading hidden" id="loading">
            <div class="spinner"></div>
            <div class="loading-text">AI æ­£åœ¨åˆ†æåœ–ç‰‡...</div>
            <div style="margin-top: 16px; color: var(--text-secondary); font-size: 0.9rem;" id="loadingProgress">
                æ­£åœ¨è™•ç†åœ–åƒç‰¹å¾µ...
            </div>
        </div>

        <!-- çµæœé¡¯ç¤ºå€åŸŸ -->
        <div class="result-container hidden" id="resultContainer">
            <div class="result-header">
                <h2 class="result-title">ğŸ¯ è¾¨è­˜çµæœ</h2>
            </div>
            <div id="resultContent"></div>
            <div class="text-center mt-4">
                <button class="btn success" onclick="shareResult()">ğŸ”— åˆ†äº«çµæœ</button>
                <button class="btn secondary" onclick="saveToHistory()">ğŸ’¾ ä¿å­˜è¨˜éŒ„</button>
                <button class="btn secondary" onclick="resetAll()">ğŸ”„ é‡æ–°é–‹å§‹</button>
            </div>
        </div>

        <!-- çµ±è¨ˆé¢æ¿ -->
        <div class="stats-panel hidden" id="statsPanel">
            <h3 class="section-title">ğŸ“ˆ æ‚¨çš„ç’°ä¿è²¢ç»</h3>
            <div class="stats-grid" id="statsGrid">
                <!-- çµ±è¨ˆæ•¸æ“šæœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æ­·å²è¨˜éŒ„é¢æ¿ -->
        <div class="history-panel hidden" id="historyPanel">
            <h3 class="section-title">ğŸ“‹ è¾¨è­˜æ­·å²</h3>
            <div id="historyContent">
                <!-- æ­·å²è¨˜éŒ„æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ç’°ä¿æˆå°±é¢æ¿ -->
        <div class="achievement-panel hidden" id="achievementPanel">
            <h3 class="section-title">ğŸ† ç’°ä¿æˆå°±</h3>
            <div class="achievement-grid" id="achievementGrid">
                <!-- æˆå°±æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // å¢å¼·çš„ç’°ä¿ç‰©å“è³‡æ–™åº«
        const ecoDatabase = {
            plastic_bottle: {
                name: "å¯¶ç‰¹ç“¶",
                category: "å¡‘è† å®¹å™¨",
                recycleCode: "PET (1è™Ÿ)",
                color: "#4299e1",
                recycleInstructions: "1. æ¸…æ´—ä¹¾æ·¨ï¼Œå»é™¤æ¨™ç±¤å’Œç“¶è“‹\n2. å£“æ‰æ¸›å°‘é«”ç©\n3. æŠ•å…¥å¡‘è† å›æ”¶æ¡¶ï¼ˆè—è‰²ï¼‰\n4. å¯å›æ”¶è£½æˆè¡£ç‰©çº–ç¶­æˆ–æ–°å®¹å™¨",
                ecoTips: "é¸æ“‡ç»ç’ƒç“¶è£é£²æ–™ï¼Œæˆ–ä½¿ç”¨å¯é‡è¤‡ä½¿ç”¨çš„æ°´ç“¶",
                weight: "ç´„15-30å…‹",
                co2Saved: "å›æ”¶1å€‹å¯¶ç‰¹ç“¶å¯ç¯€çœç´„65å…‹CO2æ’æ”¾",
                recycleRate: "95%",
                decompositionTime: "450-1000å¹´",
                keywords: ["bottle", "plastic", "drink", "water", "beverage"]
            },
            aluminum_can: {
                name: "é‹ç½",
                category: "é‡‘å±¬å®¹å™¨",
                recycleCode: "é‹ (ALU)",
                color: "#718096",
                recycleInstructions: "1. æ²–æ´—ä¹¾æ·¨å»é™¤æ®˜ç•™ç‰©\n2. å¯å£“æ‰ç¯€çœç©ºé–“\n3. æŠ•å…¥é‡‘å±¬å›æ”¶æ¡¶ï¼ˆé»ƒè‰²ï¼‰\n4. 100%å¯ç„¡é™æ¬¡å›æ”¶å†åˆ©ç”¨",
                ecoTips: "é‹ç½æ˜¯æœ€ç’°ä¿çš„åŒ…è£é¸æ“‡ï¼Œå›æ”¶æ•ˆç›Šæ¥µé«˜",
                weight: "ç´„15å…‹",
                co2Saved: "å›æ”¶1å€‹é‹ç½å¯ç¯€çœ95%çš„è£½é€ èƒ½æº",
                recycleRate: "99%",
                decompositionTime: "200-500å¹´",
                keywords: ["can", "aluminum", "soda", "beer", "drink"]
            },
            glass_bottle: {
                name: "ç»ç’ƒç“¶",
                category: "ç»ç’ƒå®¹å™¨",
                recycleCode: "ç»ç’ƒ (GL)",
                color: "#38a169",
                recycleInstructions: "1. æ¸…æ´—ä¹¾æ·¨å»é™¤æ¨™ç±¤\n2. å»é™¤é‡‘å±¬ç“¶è“‹\n3. ä¾é¡è‰²åˆ†é¡æŠ•å…¥ç»ç’ƒå›æ”¶æ¡¶\n4. å¯ç„¡é™æ¬¡å›æ”¶ä¸é™å“è³ª",
                ecoTips: "ç»ç’ƒæ˜¯æœ€ç’°ä¿çš„åŒ…è£ææ–™ï¼Œå»ºè­°å„ªå…ˆé¸æ“‡",
                weight: "ç´„200-400å…‹",
                co2Saved: "å›æ”¶1å…¬æ–¤ç»ç’ƒå¯ç¯€çœç´„315å…‹CO2æ’æ”¾",
                recycleRate: "90%",
                decompositionTime: "4000å¹´ä»¥ä¸Š",
                keywords: ["glass", "bottle", "wine", "juice", "jar"]
            },
            cardboard: {
                name: "ç´™ç›’/ç´™ç®±",
                category: "ç´™é¡",
                recycleCode: "ç´™é¡ (PAP)",
                color: "#d69e2e",
                recycleInstructions: "1. æ¸…æ´—ä¹¾æ·¨ä¸¦å¼„ä¹¾\n2. æ‹†è§£æ”¤å¹³ï¼Œå»é™¤è† å¸¶\n3. æŠ•å…¥ç´™é¡å›æ”¶æ¡¶ï¼ˆç™½è‰²ï¼‰\n4. å¯è£½æˆå†ç”Ÿç´™æˆ–æ–°ç´™ç›’",
                ecoTips: "é¸æ“‡FSCèªè­‰ç´™ç›’ï¼Œæ”¯æŒæ°¸çºŒæ—æ¥­ç®¡ç†",
                weight: "ç´„30-80å…‹",
                co2Saved: "å›æ”¶1å…¬æ–¤ç´™é¡å¯ç¯€çœç´„1.38å…¬æ–¤CO2æ’æ”¾",
                recycleRate: "85%",
                decompositionTime: "2-6å€‹æœˆ",
                keywords: ["cardboard", "box", "packaging", "paper"]
            },
            plastic_bag: {
                name: "å¡‘è† è¢‹",
                category: "è»Ÿæ€§å¡‘è† ",
                recycleCode: "PE (2/4è™Ÿ)",
                color: "#e53e3e",
                recycleInstructions: "1. æ¸…æ´—ä¹¾æ·¨ä¸¦å®Œå…¨æ™¾ä¹¾\n2. é€è‡³è¶…å•†æˆ–è³£å ´å›æ”¶é»\n3. ä¸å¯æŠ•å…¥ä¸€èˆ¬å›æ”¶æ¡¶\n4. å¯è£½æˆå¡‘è† æœ¨ææˆ–å…¬åœ’è¨­æ–½",
                ecoTips: "ä½¿ç”¨ç’°ä¿è³¼ç‰©è¢‹ï¼Œæ¸›å°‘ä¸€æ¬¡æ€§å¡‘è† è¢‹ä½¿ç”¨",
                weight: "ç´„3-8å…‹",
                co2Saved: "é‡è¤‡ä½¿ç”¨1å€‹å¡‘è† è¢‹å¯ç¯€çœç´„11å…‹CO2æ’æ”¾",
                recycleRate: "65%",
                decompositionTime: "10-1000å¹´",
                keywords: ["bag", "plastic", "shopping", "grocery"]
            },
            electronics: {
                name: "é›»å­ç”¢å“",
                category: "é›»å­å»¢æ£„ç‰©",
                recycleCode: "é›»å­é¡ (WEEE)",
                color: "#f56565",
                recycleInstructions: "1. é€è‡³æŒ‡å®šé›»å­å›æ”¶é»\n2. å°ˆæ¥­æ‹†è§£è™•ç†æœ‰å®³ç‰©è³ª\n3. å›æ”¶ç¨€åœŸé‡‘å±¬å’Œæœ‰åƒ¹ææ–™\n4. é¿å…é‡é‡‘å±¬æ±¡æŸ“ç’°å¢ƒ",
                ecoTips: "å»¶é•·é›»å­ç”¢å“ä½¿ç”¨å£½å‘½ï¼Œè€ƒæ…®ç¶­ä¿®æˆ–å‡ç´š",
                weight: "å› ç”¢å“è€Œç•°",
                co2Saved: "æ­£ç¢ºå›æ”¶å¯é¿å…æœ‰å®³ç‰©è³ªæ±¡æŸ“ä¸¦å›æ”¶è²´é‡‘å±¬",
                recycleRate: "70%",
                decompositionTime: "1000å¹´ä»¥ä¸Š",
                keywords: ["phone", "computer", "electronic", "device", "gadget"]
            },
            food_waste: {
                name: "å»šé¤˜",
                category: "æœ‰æ©Ÿå»¢æ£„ç‰©",
                recycleCode: "å»šé¤˜",
                color: "#9f7aea",
                recycleInstructions: "1. ç€ä¹¾å¤šé¤˜æ°´åˆ†\n2. å»é™¤åŒ…è£ææ–™\n3. æŠ•å…¥å»šé¤˜å›æ”¶æ¡¶ï¼ˆæ£•è‰²ï¼‰\n4. å¯è£½æˆå †è‚¥æˆ–ç”Ÿè³ªèƒ½æº",
                ecoTips: "é©é‡æ¡è²·é£Ÿæï¼Œæ¸›å°‘é£Ÿç‰©æµªè²»",
                weight: "å› é£Ÿç‰©è€Œç•°",
                co2Saved: "å»šé¤˜å †è‚¥æ¯”æ©åŸ‹è™•ç†æ¸›å°‘25%ç”²çƒ·æ’æ”¾",
                recycleRate: "80%",
                decompositionTime: "2é€±-6å€‹æœˆ",
                keywords: ["food", "waste", "organic", "compost", "fruit", "vegetable"]
            },
            paper: {
                name: "ç´™é¡",
                category: "ç´™å¼µ",
                recycleCode: "ç´™é¡ (PAP)",
                color: "#d69e2e",
                recycleInstructions: "1. ä¿æŒä¹¾ç‡¥é¿å…æ±¡æŸ“\n2. å»é™¤å¡‘è† æˆ–é‡‘å±¬é…ä»¶\n3. æŠ•å…¥ç´™é¡å›æ”¶æ¡¶\n4. å¯è£½æˆå†ç”Ÿç´™æˆ–è¡›ç”Ÿç´™",
                ecoTips: "é›™é¢ä½¿ç”¨ç´™å¼µï¼Œé¸æ“‡æ•¸ä½åŒ–æ¸›å°‘ç”¨ç´™",
                weight: "ç´„80-120å…‹/å¹³æ–¹ç±³",
                co2Saved: "å›æ”¶ç´™é¡æ¯”è£½é€ æ–°ç´™ç¯€çœ60%èƒ½æº",
                recycleRate: "85%",
                decompositionTime: "2-6é€±",
                keywords: ["paper", "document", "newspaper", "magazine", "book"]
            }
        };

        // ç’°ä¿æˆå°±ç³»çµ±
        const achievements = {
            first_scan: {
                title: "åˆæ¬¡é«”é©—",
                description: "å®Œæˆç¬¬ä¸€æ¬¡ç‰©å“è¾¨è­˜",
                icon: "ğŸ¯",
                requirement: 1
            },
            eco_warrior: {
                title: "ç’°ä¿æˆ°å£«",
                description: "è¾¨è­˜10ç¨®ä¸åŒç‰©å“",
                icon: "ğŸ›¡ï¸",
                requirement: 10
            },
            recycling_master: {
                title: "å›æ”¶å¤§å¸«",
                description: "ç´¯è¨ˆè¾¨è­˜50å€‹ç‰©å“",
                icon: "â™»ï¸",
                requirement: 50
            },
            planet_saver: {
                title: "åœ°çƒå®ˆè­·è€…",
                description: "ç´¯è¨ˆè¾¨è­˜100å€‹ç‰©å“",
                icon: "ğŸŒ",
                requirement: 100
            },
            diversity_champion: {
                title: "å¤šæ¨£æ€§å† è»",
                description: "è¾¨è­˜æ‰€æœ‰8ç¨®ç‰©å“é¡å‹",
                icon: "ğŸ†",
                requirement: 8
            }
        };

        // å…¨åŸŸè®Šæ•¸
        let currentAnalysis = null;
        let userStats = JSON.parse(localStorage.getItem('ecoStats') || '{}');
        let analysisHistory = JSON.parse(localStorage.getItem('ecoHistory') || '[]');
        let userAchievements = JSON.parse(localStorage.getItem('ecoAchievements') || '[]');
        let isDarkTheme = localStorage.getItem('darkTheme') === 'true';

        // DOM å…ƒç´ 
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.querySelector('.upload-area');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const loading = document.getElementById('loading');
        const loadingProgress = document.getElementById('loadingProgress');
        const resultContainer = document.getElementById('resultContainer');
        const resultContent = document.getElementById('resultContent');
        const statsPanel = document.getElementById('statsPanel');
        const historyPanel = document.getElementById('historyPanel');
        const achievementPanel = document.getElementById('achievementPanel');

        // åˆå§‹åŒ–ä¸»é¡Œ
        if (isDarkTheme) {
            document.body.classList.add('dark-theme');
            document.getElementById('themeIcon').textContent = 'â˜€ï¸';
        }

        // äº‹ä»¶ç›£è½å™¨
        fileInput.addEventListener('change', handleFileSelect);
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);

        // ä¸»é¡Œåˆ‡æ›åŠŸèƒ½
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.body.classList.toggle('dark-theme');
            document.getElementById('themeIcon').textContent = isDarkTheme ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('darkTheme', isDarkTheme);
        }

        // æª”æ¡ˆè™•ç†å‡½æ•¸
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) handleFile(file);
        }

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        function handleDragLeave() {
            uploadArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) handleFile(files[0]);
        }

        function handleFile(file) {
            // æª”æ¡ˆå¤§å°æª¢æŸ¥
            if (file.size > 10 * 1024 * 1024) {
                showNotification('æª”æ¡ˆå¤§å°è¶…é 10MB é™åˆ¶', 'error');
                return;
            }

            // æª”æ¡ˆé¡å‹æª¢æŸ¥
            if (!file.type.startsWith('image/')) {
                showNotification('è«‹ä¸Šå‚³åœ–ç‰‡æª”æ¡ˆï¼', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                previewImage.onload = () => {
                    showPreview();
                };
            };
            reader.readAsDataURL(file);
        }

        function showPreview() {
            hideAllSections();
            previewContainer.classList.remove('hidden');
            previewContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // å¢å¼·çš„åœ–ç‰‡åˆ†æåŠŸèƒ½
        async function analyzeImage() {
            showLoading();
            
            try {
                // æ¨¡æ“¬è¼‰å…¥é€²åº¦
                const steps = [
                    { text: 'æ­£åœ¨é è™•ç†åœ–åƒ...', delay: 500 },
                    { text: 'æå–è¦–è¦ºç‰¹å¾µ...', delay: 800 },
                    { text: 'AI æ¨¡å‹åˆ†æä¸­...', delay: 1000 },
                    { text: 'è¨ˆç®—ç½®ä¿¡åº¦...', delay: 600 },
                    { text: 'ç”Ÿæˆç’°ä¿å»ºè­°...', delay: 400 }
                ];

                for (let i = 0; i < steps.length; i++) {
                    loadingProgress.textContent = steps[i].text;
                    await new Promise(resolve => setTimeout(resolve, steps[i].delay));
                }

                // åŸ·è¡Œåœ–åƒåˆ†æ
                const result = await performAdvancedAnalysis();
                
                if (result) {
                    currentAnalysis = result;
                    displayResult(result);
                    updateUserStats(result.itemKey);
                    checkAchievements();
                } else {
                    throw new Error('ç„¡æ³•è¾¨è­˜åœ–ç‰‡å…§å®¹ï¼Œè«‹å˜—è©¦æ›´æ¸…æ™°çš„åœ–ç‰‡');
                }
                
            } catch (error) {
                console.error('è¾¨è­˜éŒ¯èª¤:', error);
                displayError(error.message);
            } finally {
                hideLoading();
            }
        }

        // é€²éšåœ–åƒåˆ†æ
        async function performAdvancedAnalysis() {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // è¨­å®šç•«å¸ƒå¤§å°
                const maxSize = 400;
                const ratio = Math.min(maxSize / previewImage.naturalWidth, maxSize / previewImage.naturalHeight);
                canvas.width = previewImage.naturalWidth * ratio;
                canvas.height = previewImage.naturalHeight * ratio;
                
                // ç¹ªè£½åœ–ç‰‡
                ctx.drawImage(previewImage, 0, 0, canvas.width, canvas.height);
                
                // ç²å–åœ–åƒæ•¸æ“š
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // å¤šç¶­åº¦ç‰¹å¾µåˆ†æ
                const features = analyzeImageFeatures(data, canvas.width, canvas.height);
                
                // åŸºæ–¼ç‰¹å¾µé€²è¡Œåˆ†é¡
                const classification = classifyObject(features);
                
                resolve({
                    name: ecoDatabase[classification.itemKey].name,
                    confidence: classification.confidence,
                    source: 'AI åœ–åƒè­˜åˆ¥',
                    itemKey: classification.itemKey,
                    features: features,
                    analysisTime: new Date().toISOString()
                });
            });
        }

        // åœ–åƒç‰¹å¾µåˆ†æ
        function analyzeImageFeatures(data, width, height) {
            const features = {
                colorDistribution: { r: 0, g: 0, b: 0 },
                brightness: 0,
                contrast: 0,
                dominantColors: [],
                edgeDetection: 0,
                symmetry: 0,
                aspectRatio: width / height,
                saturation: 0
            };

            let totalR = 0, totalG = 0, totalB = 0;
            let totalBrightness = 0;
            let pixelCount = data.length / 4;

            // é¡è‰²å’Œäº®åº¦åˆ†æ
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                totalR += r;
                totalG += g;
                totalB += b;
                
                const brightness = (r + g + b) / 3;
                totalBrightness += brightness;
                
                // é£½å’Œåº¦è¨ˆç®—
                const max = Math.max(r, g, b);
                const min = Math.min(r, g, b);
                const saturation = max === 0 ? 0 : (max - min) / max;
                features.saturation += saturation;
            }

            features.colorDistribution.r = totalR / pixelCount;
            features.colorDistribution.g = totalG / pixelCount;
            features.colorDistribution.b = totalB / pixelCount;
            features.brightness = totalBrightness / pixelCount;
            features.saturation = features.saturation / pixelCount;

            // å°æ¯”åº¦è¨ˆç®—
            let varianceSum = 0;
            for (let i = 0; i < data.length; i += 4) {
                const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;
                varianceSum += Math.pow(brightness - features.brightness, 2);
            }
            features.contrast = Math.sqrt(varianceSum / pixelCount);

            return features;
        }

        // ç‰©é«”åˆ†é¡æ¼”ç®—æ³•
        function classifyObject(features) {
            const { colorDistribution: color, brightness, contrast, saturation, aspectRatio } = features;
            
            let scores = {};
            
            // åŸºæ–¼å¤šé‡ç‰¹å¾µçš„è©•åˆ†ç³»çµ±
            Object.keys(ecoDatabase).forEach(key => {
                scores[key] = 0;
            });

            // é¡è‰²ç‰¹å¾µè©•åˆ†
            if (color.b > color.r && color.b > color.g && color.b > 140) {
                scores.plastic_bottle += 0.3;
                scores.glass_bottle += 0.1;
            }
            
            if (color.r > 180 && color.g > 160 && color.b > 140) {
                scores.aluminum_can += 0.4;
            }
            
            if (color.g > color.r && color.g > color.b && color.g > 100) {
                scores.glass_bottle += 0.3;
                scores.food_waste += 0.2;
            }
            
            if (color.r > 140 && color.g > 100 && color.b < 80) {
                scores.cardboard += 0.35;
                scores.paper += 0.25;
            }
            
            if (brightness < 80) {
                scores.electronics += 0.25;
                scores.plastic_bag += 0.15;
            }
            
            // é£½å’Œåº¦å’Œå°æ¯”åº¦ç‰¹å¾µ
            if (saturation > 0.3) {
                scores.food_waste += 0.2;
                scores.plastic_bottle += 0.1;
            }
            
            if (contrast > 50) {
                scores.electronics += 0.2;
                scores.aluminum_can += 0.15;
            }
            
            // é•·å¯¬æ¯”ç‰¹å¾µ
            if (aspectRatio > 1.5 || aspectRatio < 0.67) {
                scores.plastic_bottle += 0.15;
                scores.electronics += 0.1;
            }
            
            // äº®åº¦ç¯„åœç‰¹å¾µ
            if (brightness > 150 && brightness < 200) {
                scores.paper += 0.2;
                scores.plastic_bag += 0.15;
            }

            // æ‰¾å‡ºæœ€é«˜åˆ†çš„åˆ†é¡
            let bestMatch = 'plastic_bottle';
            let maxScore = 0;
            
            for (const [key, score] of Object.entries(scores)) {
                if (score > maxScore) {
                    maxScore = score;
                    bestMatch = key;
                }
            }
            
            // è¨ˆç®—ç½®ä¿¡åº¦
            const confidence = Math.min(0.95, Math.max(0.65, 0.7 + maxScore));
            
            return {
                itemKey: bestMatch,
                confidence: confidence,
                allScores: scores
            };
        }

        // å¿«é€Ÿé¸æ“‡åŠŸèƒ½
        function selectQuickItem(itemKey) {
            // æ¸…é™¤é¸æ“‡ç‹€æ…‹
            document.querySelectorAll('.quick-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // æ¨™è¨˜ç•¶å‰é¸æ“‡
            event.target.closest('.quick-item').classList.add('selected');
            
            // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
            showLoading();
            loadingProgress.textContent = 'æ­£åœ¨è¼‰å…¥ç‰©å“è³‡è¨Š...';
            
            setTimeout(() => {
                const result = {
                    name: ecoDatabase[itemKey].name,
                    confidence: 1.0,
                    source: 'æ‰‹å‹•é¸æ“‡',
                    itemKey: itemKey,
                    analysisTime: new Date().toISOString()
                };
                
                currentAnalysis = result;
                displayResult(result);
                updateUserStats(itemKey);
                checkAchievements();
                hideLoading();
            }, 800);
        }

        // çµæœé¡¯ç¤º
        function displayResult(result) {
            const itemData = ecoDatabase[result.itemKey];
            const confidencePercentage = Math.round(result.confidence * 100);
            
            const resultHTML = `
                <div class="item-result">
                    <div class="item-name" style="color: ${itemData.color};">${itemData.name}</div>
                    <div class="item-category">${itemData.category}</div>
                    
                    <div class="confidence-section">
                        <div class="confidence-label">
                            <span>è¾¨è­˜æº–ç¢ºåº¦</span>
                            <span>${confidencePercentage}%</span>
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidencePercentage}%;"></div>
                        </div>
                        <div style="text-align: center; margin-top: 8px; color: var(--text-secondary); font-size: 0.9rem;">
                            åˆ†æä¾†æºï¼š${result.source}
                        </div>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-card">
                            <div class="info-title">
                                <span>â™»ï¸</span>
                                å›æ”¶æ–¹å¼
                            </div>
                            <div class="info-content">
                                ${itemData.recycleInstructions.replace(/\n/g, '<br>')}
                                <div style="margin-top: 12px;">
                                    <strong>å›æ”¶æ¨™è­˜ï¼š</strong>${itemData.recycleCode}<br>
                                    <strong>å›æ”¶ç‡ï¼š</strong>${itemData.recycleRate}<br>
                                    <strong>åˆ†è§£æ™‚é–“ï¼š</strong>${itemData.decompositionTime}
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-card eco-tips">
                            <div class="info-title">
                                <span>ğŸŒ±</span>
                                ç’°ä¿å»ºè­°
                            </div>
                            <div class="info-content">
                                ${itemData.ecoTips}
                                <div style="margin-top: 12px;">
                                    <strong>ç’°ä¿æ•ˆç›Šï¼š</strong>${itemData.co2Saved}<br>
                                    <strong>é‡é‡ï¼š</strong>${itemData.weight}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            resultContent.innerHTML = resultHTML;
            hideAllSections();
            resultContainer.classList.remove('hidden');
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // éŒ¯èª¤é¡¯ç¤º
        function displayError(message) {
            const errorHTML = `
                <div class="item-result" style="border: 2px solid var(--error-color);">
                    <div class="item-name" style="color: var(--error-color);">âŒ è¾¨è­˜å¤±æ•—</div>
                    <div style="color: var(--text-secondary); margin: 20px 0; text-align: center;">
                        ${message}
                    </div>
                    
                    <div class="info-card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(245, 158, 11, 0.05));">
                        <div class="info-title">
                            <span>ğŸ’¡</span>
                            æ”¹å–„å»ºè­°
                        </div>
                        <div class="info-content">
                            â€¢ ç¢ºä¿åœ–ç‰‡æ¸…æ™°ä¸”å…‰ç·šå……è¶³<br>
                            â€¢ å°‡ç‰©å“ç½®æ–¼åœ–ç‰‡ä¸­å¤®<br>
                            â€¢ é¿å…è¤‡é›œèƒŒæ™¯å¹²æ“¾<br>
                            â€¢ æˆ–ä½¿ç”¨å¿«é€Ÿé¸æ“‡åŠŸèƒ½
                        </div>
                    </div>
                </div>
            `;
            
            resultContent.innerHTML = errorHTML;
            hideAllSections();
            resultContainer.classList.remove('hidden');
        }

        // å·¥å…·å‡½æ•¸
        function hideAllSections() {
            previewContainer.classList.add('hidden');
            resultContainer.classList.add('hidden');
            statsPanel.classList.add('hidden');
            historyPanel.classList.add('hidden');
            achievementPanel.classList.add('hidden');
        }

        function showLoading() {
            loading.classList.remove('hidden');
        }

        function hideLoading() {
            loading.classList.add('hidden');
        }

        function resetUpload() {
            fileInput.value = '';
            hideAllSections();
            document.querySelector('.main-content').scrollIntoView({ behavior: 'smooth' });
        }

        function resetAll() {
            resetUpload();
            document.querySelectorAll('.quick-item').forEach(item => {
                item.classList.remove('selected');
            });
            currentAnalysis = null;
        }

        // çµ±è¨ˆåŠŸèƒ½
        function updateUserStats(itemKey) {
            if (!userStats[itemKey]) {
                userStats[itemKey] = { count: 0, lastUsed: null };
            }
            userStats[itemKey].count++;
            userStats[itemKey].lastUsed = new Date().toISOString();
            
            // æ›´æ–°ç¸½è¨ˆ
            if (!userStats.total) {
                userStats.total = { totalItems: 0, totalCO2Saved: 0, startDate: new Date().toISOString() };
            }
            userStats.total.totalItems++;
            
            localStorage.setItem('ecoStats', JSON.stringify(userStats));
        }

        function saveToHistory() {
            if (currentAnalysis) {
                analysisHistory.unshift({
                    ...currentAnalysis,
                    id: Date.now(),
                    timestamp: new Date().toISOString()
                });
                
                // é™åˆ¶æ­·å²è¨˜éŒ„æ•¸é‡
                if (analysisHistory.length > 50) {
                    analysisHistory = analysisHistory.slice(0, 50);
                }
                
                localStorage.setItem('ecoHistory', JSON.stringify(analysisHistory));
                showNotification('çµæœå·²ä¿å­˜åˆ°æ­·å²è¨˜éŒ„', 'success');
            }
        }

        function showStats() {
            const total = userStats.total?.totalItems || 0;
            let statsHTML = '';
            
            if (total === 0) {
                statsHTML = `
                    <div class="stat-item" style="grid-column: 1 / -1;">
                        <div class="stat-number">0</div>
                        <div class="stat-label">é–‹å§‹æ‚¨çš„ç’°ä¿ä¹‹æ—…ï¼</div>
                    </div>
                `;
            } else {
                statsHTML = `
                    <div class="stat-item">
                        <div class="stat-number">${total}</div>
                        <div class="stat-label">ç¸½è¾¨è­˜æ¬¡æ•¸</div>
                    </div>
                `;
                
                // é¡¯ç¤ºå‰ä¸‰åç‰©å“
                const sortedItems = Object.entries(userStats)
                    .filter(([key]) => key !== 'total' && ecoDatabase[key])
                    .sort(([,a], [,b]) => b.count - a.count)
                    .slice(0, 3);
                
                sortedItems.forEach(([key, data]) => {
                    const itemData = ecoDatabase[key];
                    statsHTML += `
                        <div class="stat-item">
                            <div class="stat-number">${data.count}</div>
                            <div class="stat-label">${itemData.name}</div>
                        </div>
                    `;
                });

                // è¨ˆç®—ç’°ä¿è²¢ç»
                const uniqueTypes = Object.keys(userStats).filter(key => key !== 'total' && ecoDatabase[key]).length;
                statsHTML += `
                    <div class="stat-item">
                        <div class="stat-number">${uniqueTypes}</div>
                        <div class="stat-label">ç‰©å“ç¨®é¡</div>
                    </div>
                `;
            }
            
            document.getElementById('statsGrid').innerHTML = statsHTML;
            hideAllSections();
            statsPanel.classList.remove('hidden');
            statsPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // æ­·å²è¨˜éŒ„åŠŸèƒ½
        function showHistory() {
            let historyHTML = '';
            
            if (analysisHistory.length === 0) {
                historyHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ“‹</div>
                        <div>é‚„æ²’æœ‰è¾¨è­˜è¨˜éŒ„</div>
                        <div style="font-size: 0.9rem; margin-top: 8px;">é–‹å§‹è¾¨è­˜ç‰©å“ä¾†å»ºç«‹æ‚¨çš„ç’°ä¿è¨˜éŒ„å§ï¼</div>
                    </div>
                `;
            } else {
                analysisHistory.slice(0, 10).forEach(record => {
                    const itemData = ecoDatabase[record.itemKey];
                    const date = new Date(record.timestamp).toLocaleDateString('zh-TW');
                    const time = new Date(record.timestamp).toLocaleTimeString('zh-TW', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    historyHTML += `
                        <div class="history-item">
                            <div class="history-info">
                                <div class="history-icon">${itemData.category.includes('å¡‘è† ') ? 'ğŸ¼' : 
                                    itemData.category.includes('é‡‘å±¬') ? 'ğŸ¥¤' : 
                                    itemData.category.includes('ç»ç’ƒ') ? 'ğŸ¾' : 
                                    itemData.category.includes('ç´™') ? 'ğŸ“¦' : 
                                    itemData.category.includes('é›»å­') ? 'ğŸ“±' : 
                                    itemData.category.includes('æœ‰æ©Ÿ') ? 'ğŸ' : 'â™»ï¸'}</div>
                                <div class="history-details">
                                    <h4>${record.name}</h4>
                                    <p>${date} ${time} â€¢ ${record.source}</p>
                                </div>
                            </div>
                            <div class="history-confidence">${Math.round(record.confidence * 100)}%</div>
                        </div>
                    `;
                });
            }
            
            document.getElementById('historyContent').innerHTML = historyHTML;
            hideAllSections();
            historyPanel.classList.remove('hidden');
            historyPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // æˆå°±ç³»çµ±
        function checkAchievements() {
            const total = userStats.total?.totalItems || 0;
            const uniqueTypes = Object.keys(userStats).filter(key => key !== 'total' && ecoDatabase[key]).length;
            
            // æª¢æŸ¥å„ç¨®æˆå°±
            const achievementChecks = {
                first_scan: total >= 1,
                eco_warrior: total >= 10,
                recycling_master: total >= 50,
                planet_saver: total >= 100,
                diversity_champion: uniqueTypes >= 8
            };
            
            Object.entries(achievementChecks).forEach(([key, unlocked]) => {
                if (unlocked && !userAchievements.includes(key)) {
                    userAchievements.push(key);
                    showNotification(`ğŸ‰ è§£é–æˆå°±ï¼š${achievements[key].title}`, 'success', 4000);
                }
            });
            
            localStorage.setItem('ecoAchievements', JSON.stringify(userAchievements));
        }

        function showAchievements() {
            let achievementHTML = '';
            
            Object.entries(achievements).forEach(([key, achievement]) => {
                const isUnlocked = userAchievements.includes(key);
                const total = userStats.total?.totalItems || 0;
                const uniqueTypes = Object.keys(userStats).filter(k => k !== 'total' && ecoDatabase[k]).length;
                
                let progress = 0;
                switch(key) {
                    case 'first_scan':
                    case 'eco_warrior':
                    case 'recycling_master':
                    case 'planet_saver':
                        progress = Math.min(100, (total / achievement.requirement) * 100);
                        break;
                    case 'diversity_champion':
                        progress = Math.min(100, (uniqueTypes / achievement.requirement) * 100);
                        break;
                }
                
                achievementHTML += `
                    <div class="achievement-item ${isUnlocked ? 'unlocked' : ''}">
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-title">${achievement.title}</div>
                        <div class="achievement-desc">${achievement.description}</div>
                        <div style="margin-top: 12px; font-size: 0.8rem; color: var(--text-secondary);">
                            é€²åº¦: ${Math.round(progress)}%
                        </div>
                        ${isUnlocked ? '<div style="color: var(--success-color); font-weight: 600; margin-top: 8px;">âœ… å·²è§£é–</div>' : ''}
                    </div>
                `;
            });
            
            document.getElementById('achievementGrid').innerHTML = achievementHTML;
            hideAllSections();
            achievementPanel.classList.remove('hidden');
            achievementPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // åˆ†äº«åŠŸèƒ½
        function shareResult() {
            if (!currentAnalysis) {
                showNotification('è«‹å…ˆé€²è¡Œç‰©å“è¾¨è­˜', 'warning');
                return;
            }
            
            const itemData = ecoDatabase[currentAnalysis.itemKey];
            const shareText = `æˆ‘ä½¿ç”¨ EcoVision è­˜åˆ¥äº†ä¸€å€‹${itemData.name}ï¼\n\nğŸŒ± åˆ†é¡ï¼š${itemData.category}\nâ™»ï¸ å›æ”¶ç‡ï¼š${itemData.recycleRate}\nğŸŒ ${itemData.co2Saved}\n\nä¸€èµ·ä¾†ç’°ä¿å›æ”¶å§ï¼`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'EcoVision è¾¨è­˜çµæœ',
                    text: shareText,
                    url: window.location.href
                }).catch(() => {
                    copyToClipboard(shareText);
                });
            } else {
                copyToClipboard(shareText);
            }
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('çµæœå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼', 'success');
                });
            } else {
                // å‚™ç”¨æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('çµæœå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼', 'success');
            }
        }

        // åœ–ç‰‡å¢å¼·åŠŸèƒ½
        function enhanceImage() {
            showNotification('åœ–ç‰‡å¢å¼·åŠŸèƒ½é–‹ç™¼ä¸­...', 'info');
        }

        // ç’°ä¿å°è²¼å£«
        function showTips() {
            const tips = [
                "ğŸŒ± é¸æ“‡å¯é‡è¤‡ä½¿ç”¨çš„å®¹å™¨ï¼Œæ¸›å°‘ä¸€æ¬¡æ€§åŒ…è£",
                "â™»ï¸ æ­£ç¢ºåˆ†é¡å›æ”¶ï¼Œæé«˜å›æ”¶æ•ˆç‡",
                "ğŸŒ å„ªå…ˆé¸æ“‡ç•¶åœ°ç”Ÿç”¢çš„å•†å“ï¼Œæ¸›å°‘ç¢³è¶³è·¡",
                "ğŸ’š è³¼è²·äºŒæ‰‹å•†å“ï¼Œå»¶é•·ç‰©å“ä½¿ç”¨å£½å‘½",
                "ğŸ”‹ ä½¿ç”¨å……é›»é›»æ± æ›¿ä»£ä¸€æ¬¡æ€§é›»æ± ",
                "ğŸ“± å®šæœŸæ¸…ç†æ‰‹æ©Ÿï¼Œå»¶é•·é›»å­ç”¢å“å£½å‘½",
                "ğŸ›ï¸ è‡ªå‚™è³¼ç‰©è¢‹ï¼Œæ¸›å°‘å¡‘è† è¢‹ä½¿ç”¨",
                "ğŸŒ¿ é¸æ“‡ç„¡åŒ…è£æˆ–ç°¡åŒ…è£å•†å“",
                "ğŸ’¡ ä½¿ç”¨LEDç‡ˆæ³¡ï¼Œç¯€çœèƒ½æºæ¶ˆè€—",
                "ğŸš² å¤šä½¿ç”¨å¤§çœ¾é‹è¼¸æˆ–é¨è‡ªè¡Œè»Š"
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            showNotification(randomTip, 'info', 5000);
        }

        // é€šçŸ¥ç³»çµ±
        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 20px;
                border-radius: 12px;
                color: white;
                font-weight: 500;
                box-shadow: var(--shadow-lg);
                z-index: 1000;
                backdrop-filter: blur(10px);
                max-width: 300px;
                word-wrap: break-word;
                animation: slideInRight 0.3s ease-out;
            `;
            
            const colors = {
                success: 'linear-gradient(135deg, var(--success-color), var(--primary-color))',
                error: 'linear-gradient(135deg, var(--error-color), #dc2626)',
                warning: 'linear-gradient(135deg, var(--warning-color), #d97706)',
                info: 'linear-gradient(135deg, var(--secondary-color), var(--accent-color))'
            };
            
            notification.style.background = colors[type] || colors.info;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in forwards';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                resetAll();
            } else if (e.key === 'Enter' && !previewContainer.classList.contains('hidden')) {
                analyzeImage();
            } else if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveToHistory();
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸŒ¿ EcoVision ç’°ä¿ç‰©å“è¾¨è­˜ç³»çµ±å·²å•Ÿå‹•');
            
            // æª¢æŸ¥æ˜¯å¦æœ‰ç¾æœ‰æˆå°±
            checkAchievements();
            
            // é¡¯ç¤ºæ­¡è¿è¨Šæ¯
            setTimeout(() => {
                showNotification('æ­¡è¿ä½¿ç”¨ EcoVisionï¼é–‹å§‹æ‚¨çš„ç’°ä¿ä¹‹æ—…å§ ğŸŒ±', 'info', 4000);
            }, 1000);
        });
    </script>
</body>
</html>